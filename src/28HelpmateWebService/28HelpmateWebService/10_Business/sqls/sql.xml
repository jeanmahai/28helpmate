<?xml version="1.0" encoding="utf-8" ?>
<Sqls>
  <sql name="QuerySupperTrend_28BJ_1">
    <![CDATA[
SELECT 
	CONVERT(NCHAR(40),BJ.RetNum) as Name,
	COUNT(BJ.RetNum) AS Total
FROM dbo.SourceData_28_Beijing BJ
	JOIN dbo.UseSite US 
		ON BJ.SiteSysNo=US.SysNo
WHERE BJ.SiteSysNo=:SITE_SYS_NO
	  AND BJ.PeriodNum>:MIN_PERIOD
    {0}
GROUP BY BJ.RetNum
    ]]>
  </sql>
  <sql name="QuerySupperTrend_28BJ_2">
    <![CDATA[
(
SELECT RC.BigOrSmall AS Name,
       COUNT(RC.BigOrSmall) AS Total
FROM dbo.SourceData_28_Beijing BJ
	JOIN dbo.ResultCategory_28 RC
		ON BJ.RetNum=RC.RetNum
	JOIN dbo.UseSite US
		ON BJ.SiteSysNo=US.SysNo
WHERE BJ.SiteSysNo=:SITE_SYS_NO
      AND BJ.PeriodNum>:MIN_PERIOD
      {0}
GROUP BY RC.BigOrSmall
)
UNION ALL
(
SELECT RC.MiddleOrSide AS Name,
       COUNT(RC.MiddleOrSide) AS Total
FROM dbo.SourceData_28_Beijing BJ
	JOIN dbo.ResultCategory_28 RC
		ON BJ.RetNum=RC.RetNum
	JOIN dbo.UseSite US
		ON BJ.SiteSysNo=US.SysNo
WHERE BJ.SiteSysNo=:SITE_SYS_NO
      AND BJ.PeriodNum>:MIN_PERIOD
      {0}
GROUP BY RC.MiddleOrSide
)
UNION ALL
(
SELECT RC.OddOrDual AS Name,
       COUNT(RC.OddOrDual) AS Total
FROM dbo.SourceData_28_Beijing BJ
	JOIN dbo.ResultCategory_28 RC
		ON BJ.RetNum=RC.RetNum
	JOIN dbo.UseSite US
		ON BJ.SiteSysNo=US.SysNo
WHERE BJ.SiteSysNo=:SITE_SYS_NO
      AND BJ.PeriodNum>:MIN_PERIOD
      {0}
GROUP BY RC.OddOrDual
)
    ]]>
  </sql>

  <sql name="QuerySupperTrend_28BJ_3">
    <![CDATA[
SELECT COUNT(1) Total,
       :PAGE_INDEX PageIndex,
       :PAGE_SIZE PageSize,
       CEILING(COUNT(1)/CONVERT(DECIMAL,:PAGE_SIZE)) AS [PageCount]
FROM dbo.SourceData_28_Beijing BJ
	JOIN dbo.UseSite US
		ON BJ.SiteSysNo=US.SysNo
	JOIN dbo.ResultCategory_28 RC
		ON BJ.RetNum=RC.RetNum
WHERE BJ.SiteSysNo=:SITE_SYS_NO
      AND BJ.PeriodNum>:MIN_PERIOD
      {0}
    ]]>
  </sql>

  <sql name="QuerySupperTrend_28BJ_4">
    <![CDATA[

SELECT * FROM 
(
SELECT BJ.PeriodNum,
       BJ.RetTime,
       BJ.RetNum,
       RC.BigOrSmall,
       RC.MiddleOrSide,
       RC.OddOrDual,
       ROW_NUMBER() OVER (ORDER BY BJ.PeriodNum DESC) AS ROW
FROM dbo.SourceData_28_Beijing BJ
	JOIN dbo.UseSite US
		ON BJ.SiteSysNo=US.SysNo
	JOIN dbo.ResultCategory_28 RC
		ON BJ.RetNum=RC.RetNum
WHERE BJ.SiteSysNo=:SITE_SYS_NO
      AND BJ.PeriodNum>:MIN_PERIOD
      {0}
) AS TEMP
WHERE ROW>:PAGE_INDEX*:PAGE_SIZE
      AND ROW<(:PAGE_INDEX+1)*:PAGE_SIZE
    ]]>
  </sql>
  
  <sql name="QueryOmissionAllForBJ">
    <![CDATA[
DECLARE @MAX_P INT
SELECT @MAX_P=MAX(PeriodNum) FROM dbo.SourceData_28_Beijing
SELECT MAX(PeriodNum) AS NearPeriod
        ,MAX(RetNum) AS [Number]
        ,(@MAX_P-MAX(PeriodNum)) AS [Interval]
FROM dbo.SourceData_28_Beijing
GROUP BY RetNum
    ]]>
  </sql>
  <sql name="QueryTrend2">
    <![CDATA[

(
SELECT RC.BigOrSmall AS Name
      ,COUNT(RC.BigOrSmall) AS Total
      
FROM dbo.SourceData_28_Beijing BJ
	INNER JOIN dbo.ResultCategory_28 RC
		ON BJ.RetNum=RC.RetNum
	INNER JOIN DBO.UseSite US
    ON BJ.SiteSysNo=US.SysNo
WHERE BJ.RetTime BETWEEN :START_DATE AND :END_DATE
	AND US.SysNo=:SiteSysNo
GROUP BY RC.BigOrSmall
)
union
(
SELECT RC.MiddleOrSide AS Name
      ,COUNT(RC.MiddleOrSide) AS Total
      
FROM dbo.SourceData_28_Beijing BJ
	INNER JOIN dbo.ResultCategory_28 RC
		ON BJ.RetNum=RC.RetNum
		INNER JOIN DBO.UseSite US
    ON BJ.SiteSysNo=US.SysNo
WHERE BJ.RetTime BETWEEN :START_DATE AND :END_DATE
AND US.SysNo=:SiteSysNo
GROUP BY RC.MiddleOrSide
)
union
(
SELECT RC.OddOrDual AS Name
      ,COUNT(RC.OddOrDual) AS Total
      
FROM dbo.SourceData_28_Beijing BJ
	INNER JOIN dbo.ResultCategory_28 RC
		ON BJ.RetNum=RC.RetNum
		INNER JOIN DBO.UseSite US
    ON BJ.SiteSysNo=US.SysNo
WHERE BJ.RetTime BETWEEN :START_DATE AND :END_DATE
AND US.SysNo=:SiteSysNo
GROUP BY RC.OddOrDual
)
union
(
SELECT convert(nvarchar(40),RetNum) as Name,
	   COUNT(RetNum) AS Total
FROM dbo.SourceData_28_Beijing BJ
	INNER JOIN dbo.UseSite US
		ON BJ.SiteSysNo=US.SysNo
WHERE (RetTime BETWEEN :START_DATE AND :END_DATE)
	AND US.SysNo=:SiteSysNo
GROUP BY RetNum
)
  ]]>
  </sql>
  <sql name="QueryTrend3">
    <![CDATA[
SELECT BJ.PeriodNum,
       BJ.RetTime,
       BJ.RetNum,
       RC.BigOrSmall,
       RC.MiddleOrSide,
       RC.OddOrDual
FROM dbo.SourceData_28_Beijing BJ
	JOIN dbo.ResultCategory_28 RC
		ON BJ.RetNum=RC.RetNum
WHERE (BJ.RetTime BETWEEN :START_DATE AND :END_DATE)
AND BJ.SiteSysNo=:SiteSysNo
order by BJ.PeriodNum DESC
  ]]>
  </sql>
</Sqls>
